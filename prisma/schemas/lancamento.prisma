// ============================================
// MODEL: LANÇAMENTO - Transações financeiras
// ============================================

model Lancamento {
  id                    Int            @id @default(autoincrement())
  user_id               Int
  tipo                  TipoLancamento
  data                  DateTime // Data do lançamento/agendamento
  descricao             String?        @db.VarChar(255)
  observacao_automatica String?        @db.VarChar(500) // Descrição automática para parcelamentos

  categoria_id   Int
  despesa_id     Int?
  fonte_renda_id Int?

  // Campo de valor
  valor Decimal @db.Decimal(10, 2) // Valor do lançamento

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relacionamentos
  user       User        @relation(fields: [user_id], references: [id], onDelete: Restrict)
  categoria  Categoria   @relation(fields: [categoria_id], references: [id], onDelete: Restrict)
  despesa    Despesa?    @relation(fields: [despesa_id], references: [id], onDelete: Restrict)
  fonteRenda FonteRenda? @relation(fields: [fonte_renda_id], references: [id], onDelete: Restrict)

  // Índices simples
  @@index([user_id])
  @@index([despesa_id])
  @@index([fonte_renda_id])
  @@index([data])
  @@index([categoria_id])
  @@index([tipo])
  
  // Índices compostos para otimização de queries comuns
  @@index([user_id, data(sort: Desc)]) // Listagem de lançamentos por usuário ordenado por data
  @@index([user_id, tipo]) // Filtro por tipo de lançamento
  @@index([user_id, categoria_id, data]) // Filtro por categoria
  @@index([user_id, despesa_id, data]) // Filtro por despesa
  
  @@map("lancamentos")
}
